<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">

<html>
    <head>
        <link href="styles/mainStyle.css" type="text/css" rel="stylesheet" />
        <meta http-equiv="content-type" content="text/html; charset=utf-8"/>
	    <title>Лизинговый калькулятор</title> 
        <script src="js/jquery.min.js"></script> 
        <script src="js/highcharts/highcharts.js"></script>   
        <script src="js/highcharts/highcharts-more.js"></script>
        <script src="js/highcharts/modules/exporting.js"></script>             
    </head>
    <body>
        <header>
            <img id="logo" src="img/logo.gif">
            <h2>Лизинговый калькулятор</h2>
        </header>
        <form action="">
            <div style="position:absolute; top:75px; left:125px;">
                <h3>ПРЕДМЕТ ЛИЗИНГА:</h3>    
                <select multiple onchange="calculate()" id="slctLeasingSubject" style="width:225px;">
                    <option value="22">Автомобили марки ГАЗ</option>
                    <option value="25">Грузовики и спецтехника</option>
                    <option value="25">Легковые автомобили</option>
                </select>        
            </div>
            <div style="position:absolute; top:75px; right:200px;">
                <h3 style="text-align:left">
                    СТОИМОСТЬ:
                    <br />
                    <input type="text" id="tbLeasingAmount" class="textbox" onchange="calculate()" value="0" />
                    руб.
                </h3>
            </div>
            <div class="smallSpeedometr" style="position: absolute; top: 250px; left: 100px;">   
                <canvas width=225 height=125 id="advanceGauge"></canvas>
                <h3>
                    АВАНС:
                    <input type="text" id="tbPercent" name="percent" style="width: 15px" onchange="calcAdvance(); calculate();" class="smallTextbox" value="0" />
                    %
                    <br />
                    <input type="text" id="tbAdvance" onchange="calculate()" class="smallTextbox" value="0" />
                    руб.
                </h3>
            </div>   
            <div id="container" style="min-width: 300px; max-width: 300px; height: 300px; position: absolute; top: 200px; left: 350px;"></div>
            <!--<div class="speedometr" style="position: absolute; top: 200px; left: 350px;">        
                <canvas width=300 height=165 id="monthGauge"></canvas>
                <h3>
                    СРОК ЛИЗИНГА:
                    <input type="text" id="tbMonth" style="width: 15px" onchange="calculate()" class="smallTextbox" value="6" />
                    мес.
                </h3>
            </div> -->
            <div class="smallSpeedometr" style="position: absolute; top: 250px; left: 675px;">
                <h3 style="position:relative; top:30px; left:25px; text-align:left; width:50px;">ВАШ ЕЖЕМЕСЯЧНЫЙ ПЛАТЕЖ:</h3>
                <input type="text" id="payment" style="background-color: #fa9829; position:relative; top: 20px; left: 15px;" disabled value="0" /> руб.
            </div>
            <div class="footer">
                График лизинговых платежей формируется индивидуально и рассчитан на потребности бизнеса каждого клиента. Мы с удовольствием предоставим вам индивидуальный расчет стоимости лизинга в самые короткие сроки, если вы направите нам заявку на лизинг или обратитесь напрямую к финансовому консультанту.
            </div>
            <div style="position:absolute; top:525px; right:50px;">
                <input type="button" class="button" value="Получить одобрение" onclick="enterEmail()" />
            </div>
        </form>
    </body>

</html>

<script language="javascript" type="text/javascript">

    $(function () {
	
    $('#container').highcharts({
	
	    chart: {
	        type: 'gauge',
	        plotBackgroundColor: null,
	        plotBackgroundImage: null,
	        plotBorderWidth: 1,
	        plotShadow: false
	    },
	    
	    title: {
            text: 'Срок лизинга:'
	    },
	    
	    pane: {
	        startAngle: -120,
	        endAngle: 120,
	        background: [{
	            backgroundColor: {
	                linearGradient: { x1: 0, y1: 1, x2: 0, y2: 0 },
	                stops: [
	                    [0, '#FFF'],
	                    [1, '#333']
	                ]
	            },
	            borderWidth: 0,
	            outerRadius: '109%'
	        }, {
	            backgroundColor: {
	                linearGradient: { x1: 0, y1: 0, x2: 0, y2: 1 },
	                stops: [
	                    [0, '#333'],
	                    [1, '#FFF']
	                ]
	            },
	            borderWidth: 5,
	            outerRadius: '115%'
	        }, {
	            // default background
	        }, {
	            backgroundColor: '#DDD',
	            borderWidth: 0,
	            outerRadius: '105%',
	            innerRadius: '103%'
	        }]
	    },
	       
	    // the value axis
	    yAxis: {
	        min: 6,
	        max: 42,
	        
	        minorTickInterval: 1,
	        minorTickWidth: 1,
	        minorTickLength: 10,
	        minorTickPosition: 'inside',
	        minorTickColor: '#666',
	
	        tickPixelInterval: 10,
	        tickWidth: 2,
	        tickPosition: 'inside',
	        tickLength: 10,
	        tickColor: '#666',
	        labels: {
	            step: 3,
	            rotation: 'auto'
	        },
	        title: {
	            text: 'месяцы'
	        },
	    },
	
	    series: [{
	        name: 'Срок лизинга',
	        data: [6],
	        tooltip: {
	            valueSuffix: 'мес'
	        }
	    }]
	
	}, 
	// Add some life
	function (chart) {
		if (!chart.renderer.forExport) {
		    setInterval(function () {
		        var point = chart.series[0].points[0],
		            newVal,
		            inc = Math.round((Math.random() - 0.5) * 20);
		        
		        newVal = point.y + inc;
		        if (newVal < 6 || newVal > 42) {
		            newVal = point.y - inc;
		        }
		        
		        point.update(newVal);
		        
		    }, 3000);
		}
	});
});
    
    function calculate() {
        updateGauge()
        leasingAmount = document.getElementById("tbLeasingAmount").value;
        advance = document.getElementById("tbAdvance").value;
        advancePercent = document.getElementById("tbPercent").value;
        irrPercent = document.getElementById("slctLeasingSubject").value;

        calcPercent();

        c = leasingAmount - ((leasingAmount / 100) * advancePercent);
        b = (irrPercent / 100) / 12;

        document.getElementById("payment").value = Math.ceil((c * b) / (1 - (1 / Math.pow((1 + b), document.getElementById("tbMonth").value))));
        initGauge();
        update();
    }

    function calcPercent() {
        percent = Math.ceil((document.getElementById("tbAdvance").value * 100) / document.getElementById("tbLeasingAmount").value);

        if (percent <= 50)
            document.getElementById("tbPercent").value = percent;
        else {
            alert("Размер аванса не должен превышать 50% от стоимости предмета лизинга!");
            calcAdvance(50);
        }
    }

    function calcAdvance(percent) {
        
        if (percent == null)
            percent = document.getElementById("tbPercent").value;
        else
            document.getElementById("tbPercent").value = percent;

        document.getElementById("tbAdvance").value = Math.ceil((percent / 100) * document.getElementById("tbLeasingAmount").value);
    }

    function enterEmail() {
        var x;
        var email = prompt("Введите свой email:");

        if (email != null) {
            alert("Вы ввели: " + email);
        }
    }

</script>