<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">

<html>
    <head>
        <link href="styles/mainStyle.css" type="text/css" rel="stylesheet" />
        <meta http-equiv="content-type" content="text/html; charset=utf-8"/>
	    <title>Лизинговый калькулятор</title> 
        <script src="flipCounter/jquery.flipCounter.1.2.pack.js" type="text/javascript"></script>
        <script src="js/jquery.min.js"></script>   
        <script src="js/gauge.js"></script>             
    </head>
    <body>
        <header>
            <img id="logo" src="img/logo.gif">
            <h2>Лизинговый калькулятор</h2>
        </header>
        <form action="">
            <div style="position:absolute; top:75px; left:125px;">
                <h3>ПРЕДМЕТ ЛИЗИНГА:</h3>    
                <select multiple onchange="calculate()" id="slctLeasingSubject" style="width:225px;">
                    <option value="22">Автомобили марки ГАЗ</option>
                    <option value="25">Грузовики и спецтехника</option>
                    <option value="25">Легковые автомобили</option>
                </select>        
            </div>
            <div style="position:absolute; top:75px; right:200px;">
                <h3 style="text-align:left">
                    СТОИМОСТЬ:
                    <br />
                    <input type="text" id="tbLeasingAmount" class="textbox" onchange="calculate()" value="0" />
                    руб.
                </h3>
            </div>
            <div class="smallSpeedometr" style="position: absolute; top: 250px; left: 100px;">   
                <canvas width=225 height=125 id="advanceGauge"></canvas>
                <h3>
                    АВАНС:
                    <input type="text" id="tbPercent" name="percent" style="width: 15px" onchange="calcAdvance(); calculate();" class="smallTextbox" value="0" />
                    %
                    <br />
                    <input type="text" id="tbAdvance" onchange="calculate()" class="smallTextbox" value="0" />
                    руб.
                </h3>
            </div>   
            <div class="speedometr" style="position: absolute; top: 200px; left: 350px;">        
                <canvas width=300 height=165 id="monthGauge"></canvas>
                <h3>
                    СРОК ЛИЗИНГА:
                    <input type="text" id="tbMonth" style="width: 15px" onchange="calculate()" class="smallTextbox" value="6" />
                    мес.
                </h3>
            </div> 
            <div class="smallSpeedometr" style="position: absolute; top: 250px; left: 675px;">
                <h3 style="position:relative; top:30px; left:25px; text-align:left; width:50px;">ВАШ ЕЖЕМЕСЯЧНЫЙ ПЛАТЕЖ:</h3>
                <input type="text" id="payment" style="background-color: #fa9829; position:relative; top: 20px; left: 15px;" disabled value="0" /> руб.
                <div id="counter"><input type="hidden" name="counter-value" value="100" /></div>
            </div>
            <div class="footer">
                График лизинговых платежей формируется индивидуально и рассчитан на потребности бизнеса каждого клиента. Мы с удовольствием предоставим вам индивидуальный расчет стоимости лизинга в самые короткие сроки, если вы направите нам заявку на лизинг или обратитесь напрямую к финансовому консультанту.
            </div>
            <div style="position:absolute; top:525px; right:50px;">
                <input type="button" class="button" value="Получить одобрение" onclick="enterEmail()" />
            </div>
        </form>
    </body>

</html>

<script language="javascript" type="text/javascript">

    jQuery(document).ready(function ($) {
        $("#counter").flipCounter({
            number: 0, // the initial number the counter should display, overrides the hidden field
            numIntegralDigits: 1, // number of places left of the decimal point to maintain
            numFractionalDigits: 0, // number of places right of the decimal point to maintain
            digitClass: "counter-digit", // class of the counter digits
            counterFieldName: "counter-value", // name of the hidden field
            digitHeight: 40, // the height of each digit in the flipCounter-medium.png sprite image
            digitWidth: 30, // the width of each digit in the flipCounter-medium.png sprite image
            imagePath: "img/flipCounter-medium.png", // the path to the sprite image relative to your html document
            easing: false, // the easing function to apply to animations, you can override this with a jQuery.easing method
            duration: 10000, // duration of animations
            onAnimationStarted: false, // call back for animation upon starting
            onAnimationStopped: false, // call back for animation upon stopping
            onAnimationPaused: false, // call back for animation upon pausing
            onAnimationResumed: false // call back for animation upon resuming from pause
        });
    });

    function initBigGauge() {
        var opts = {
            lines: 12, // The number of lines to draw
            angle: 0.0, // The length of each line
            lineWidth: 0.03, // The line thickness
            pointer: {
                length: 0.9, // The radius of the inner circle
                strokeWidth: 0.05, // The rotation offset
                color: '#f25a2c' // Fill color
            },
            limitMax: 'true',   // If true, the pointer will not go past the end of the gauge

            colorStart: '#6FADCF',   // Colors
            colorStop: '#8FC0DA',    // just experiment with them
            strokeColor: '#E0E0E0',   // to see which ones work best for you
            generateGradient: false
        };

        var target = document.getElementById('monthGauge'); // your canvas element
        bigGauge = new Gauge(target).setOptions(opts); // create sexy gauge!
        bigGauge.setMinValue(6);
        bigGauge.maxValue = 42; // set max gauge value
        bigGauge.animationSpeed = 32; // set animation speed (32 is default value)
        bigGauge.set(6); // set actual value
    };

    function initSmallGauge() {
        var opts = {
            lines: 12, // The number of lines to draw
            angle: 0.0, // The length of each line
            lineWidth: 0.03, // The line thickness
            pointer: {
                length: 0.9, // The radius of the inner circle
                strokeWidth: 0.05, // The rotation offset
                color: '#f25a2c' // Fill color
            },
            limitMax: 'true',   // If true, the pointer will not go past the end of the gauge

            colorStart: '#6FADCF',   // Colors
            colorStop: '#8FC0DA',    // just experiment with them
            strokeColor: '#E0E0E0',   // to see which ones work best for you
            generateGradient: true
        };

        var target = document.getElementById('advanceGauge'); // your canvas element
        smallGauge = new Gauge(target).setOptions(opts); // create sexy gauge!
        smallGauge.maxValue = 50; // set max gauge value
        smallGauge.animationSpeed = 32; // set animation speed (32 is default value)
        smallGauge.set(0); // set actual value
    };
    $(function () {

        initSmallGauge();
        initBigGauge();
    });

    function updateSmallGauge(setValue) {

        smallGauge.set(setValue);
        AnimationUpdater.run();
    }

    function updateBigGauge(setValue) {

        bigGauge.set(setValue);
        AnimationUpdater.run();
    }

    function calculate() {
        calcPercent();

        leasingAmount = document.getElementById("tbLeasingAmount").value;
        advance = document.getElementById("tbAdvance").value;
        advancePercent = document.getElementById("tbPercent").value;
        irrPercent = document.getElementById("slctLeasingSubject").value;
        month = document.getElementById("tbMonth").value;
        
        updateSmallGauge(parseInt(advance));
        updateBigGauge(parseInt(month));


        c = leasingAmount - ((leasingAmount / 100) * advancePercent);
        b = (irrPercent / 100) / 12;

        document.getElementById("payment").value = Math.ceil((c * b) / (1 - (1 / Math.pow((1 + b), month))));
    }

    function calcPercent() {
        percent = Math.ceil((document.getElementById("tbAdvance").value * 100) / document.getElementById("tbLeasingAmount").value);

        if (percent <= 50)
            document.getElementById("tbPercent").value = percent;
        else {
            alert("Размер аванса не должен превышать 50% от стоимости предмета лизинга!");
            calcAdvance(50);
        }
    }

    function calcAdvance(percent) {
        
        if (percent == null)
            percent = document.getElementById("tbPercent").value;
        else
            document.getElementById("tbPercent").value = percent;

        document.getElementById("tbAdvance").value = Math.ceil((percent / 100) * document.getElementById("tbLeasingAmount").value);
    }

    function enterEmail() {
        var x;
        var email = prompt("Введите свой email:");

        if (email != null) {
            alert("Вы ввели: " + email);
        }
    }

</script>